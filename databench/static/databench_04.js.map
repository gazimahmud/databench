{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/connection.js","js/main.js","js/ui.js"],"names":[],"mappings":"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","file":"databench_04.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\nexport class Connection {\n    constructor(error_cb, analysis_id=null, ws_url=null) {\n        this.error_cb = error_cb;\n        this.analysis_id = analysis_id;\n        this.ws_url = ws_url ? ws_url : this.guess_ws_url();\n\n        this.on_callbacks = {};\n        this.onAction_callbacks = {};\n\n        this.ws_reconnect_attempt = 0;\n        this.ws_reconnect_delay = 100.0;\n\n        this.socket = null;\n        this.socket_check_open = null;\n        this.ws_connect();\n    }\n\n    guess_ws_url() {\n        var ws_protocol = 'ws';\n        if (location.origin.startsWith('https://')) ws_protocol = 'wss';\n\n        let path = location.pathname.substring(0, location.pathname.lastIndexOf('/'));\n        return `${ws_protocol}://${document.domain}:${location.port}${path}/ws`;\n    }\n\n    ws_connect() {\n        this.socket = new WebSocket(this.ws_url);\n\n        this.socket_check_open = setInterval(this.ws_check_open.bind(this), 2000);\n        this.socket.onopen = this.ws_onopen.bind(this);\n        this.socket.onclose = this.ws_onclose.bind(this);\n        this.socket.onmessage = this.ws_onmessage.bind(this);\n    }\n\n    ws_check_open() {\n        if (this.socket.readyState == WebSocket.CONNECTING) {\n            return;\n        }\n        if (this.socket.readyState != WebSocket.OPEN) {\n            this.error_cb(\n                'Connection could not be opened. '+\n                'Please <a href=\"javascript:location.reload(true);\" '+\n                'class=\"alert-link\">reload</a> this page to try again.'\n            );\n        }\n        window.clearInterval(this.socket_check_open);\n    }\n\n    ws_onopen() {\n        this.ws_reconnect_attempt = 0;\n        this.ws_reconnect_delay = 100.0;\n        this.error_cb();  // clear errors\n        this.socket.send(JSON.stringify({'__connect': this.analysis_id}));\n    }\n\n    ws_onclose() {\n        window.clearInterval(this.socket_check_open);\n\n        ws_reconnect_attempt += 1;\n        ws_reconnect_delay *= 2;\n\n        if (ws_reconnect_attempt > 3) {\n            this.error_cb(\n                'Connection closed. '+\n                'Please <a href=\"javascript:location.reload(true);\" '+\n                'class=\"alert-link\">reload</a> this page to reconnect.'\n            );\n            return;\n        }\n\n        let actual_delay = 0.7 * ws_reconnect_delay + 0.3 * Math.random() * ws_reconnect_delay;\n        console.log(`WebSocket reconnect attempt ${ws_reconnect_attempt} in ${actual_delay}ms.`);\n        setTimeout(this.ws_connect, actual_delay);\n    }\n\n    ws_onmessage(event) {\n        let message = JSON.parse(event.data);\n\n        // connect response\n        if (message.signal == '__connect') {\n            this.analysis_id = message.load.analysis_id;\n            console.log('Set analysis_id to ' + this.analysis_id);\n        }\n\n        // actions\n        if (message.signal == '__action') {\n            let id = message.load.id;\n            this.onAction_callbacks[id].map((cb) => cb(message.load.status));\n        }\n\n        // normal message\n        if (message.signal in this.on_callbacks) {\n            this.on_callbacks[message.signal].map((cb) => cb(message.load));\n        }\n    }\n\n\n    on(signalName, callback) {\n        if (!(signalName in this.on_callbacks))\n            this.on_callbacks[signalName] = [];\n        this.on_callbacks[signalName].push(callback);\n    }\n\n    emit(signalName, message) {\n        if (this.socket.readyState != 1) {\n            setTimeout(() => emit(signalName, message), 5);\n            return;\n        }\n        this.socket.send(JSON.stringify({'signal':signalName, 'load':message}));\n    }\n\n    onAction(actionID, callback) {\n        if (!(actionID in this.onAction_callbacks))\n            this.onAction_callbacks[actionID] = [];\n        this.onAction_callbacks[actionID].push(callback);\n    }\n}\n","import * as ui from './ui';\nimport { Connection } from './connection';\n\n// create a public interface\nvar Databench04 = window.Databench04 || {};\nDatabench04.ui = ui;\nDatabench04.Connection = Connection;\nwindow.Databench04 = Databench04;\n","\nexport class Log {\n\tconstructor(node, limit=20, consoleFnName='log') {\n\t\tthis.node = node;\n\t\tthis.limit = limit;\n\t\tthis.consoleFnName = consoleFnName;\n\n\t\tthis._messages = [];\n\n\t\t// capture events from frontend\n\t\tlet _consoleFnOriginal = console[consoleFnName];\n\t\tconsole[consoleFnName] = (message) => {\n\t\t\tthis.add(message, 'frontend');\n\t\t\t_consoleFnOriginal.apply(console, [message]);\n\t\t}\n\t}\n\n\trender() {\n\t\twhile(this._messages.length > this.limit) this._messages.shift();\n\n\t\t// for HTML output, json-stringify messages and join with <br>\n\t\tthis.node.innerText = this._messages.map((m) => m.join('')).join('\\n');\n\t}\n\n\tadd(message, source='unknown') {\n\t\tif (typeof message != \"string\") {\n\t\t\tmessage = JSON.stringify(message);\n\t\t}\n\n\t\tthis._messages.push([' '.repeat(Math.max(0, 8 - source.length)) + source + ': ', message]);\n\t\tthis.render();\n\t};\n\n\tstatic wire(id='log', source='backend', limit=20, consoleFnName='log') {\n\t\tlet node = document.getElementById(id);\n\t\tif (node == null) return;\n\n\t\tconsole.log(`Wiring element id=${id} to ${source}.`);\n\t\tlet l = new Log(node, limit, consoleFnName);\n\t\treturn function(message) { l.add(message, source); };\n\t}\n};\n"]}